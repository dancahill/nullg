#!/usr/bin/nesla
if (typeof(_SERVER)!='table') {
	global _SERVER = { REQUEST_METHOD="GET", PATH_INFO="/nesla/blah" };
} # this is a debug block
if (string.cmp(_SERVER['REQUEST_METHOD'], "POST")==0) {
	var path=_POST['PATH'];
	var command=_POST['COMMAND'];
} else {
	var path=_filepath;
	var command="ps auxw";
}
print(
	"<HTML>\n",
	"<TITLE>Simple XML/MIME test page</TITLE>\n",
	"<HEAD>\n",
	"<STYLE TYPE=text/css>\n",
	"A        { color: #0000FF; text-decoration: none; }\n",
	"A:HOVER  { background-color: #E0E0FF; }\n",
	"</STYLE>\n",
	"</HEAD>\n",
	"<BODY>\n",
	"<CENTER>\n",
	"<FORM ACTION='", _SERVER['PATH_INFO'], "' METHOD='POST' NAME='TEST'>\n",
	"<SELECT NAME=type style='width:255px'>
<OPTION VALUE=MIME>MIME
<OPTION VALUE=XML");
if (_POST['TYPE']=='XML') print(" SELECTED");
print(">XML
	</SELECT>
	<input type='submit' value='go' name='submit'>\n",
	"</CENTER>\n"
);
print("<TEXTAREA WRAP=PHYSICAL NAME=DATA ROWS=25 COLS=80 style='width:100%'>\n");
if (_POST['DATA']!=null) print(_POST['DATA']);
print("</TEXTAREA>");
print("</FORM>");

rc=dl.loadlib("/usr/local/lib/nesla/libneslaext.so");
if (_POST['DATA']!=null) {
	print("<HR><PRE>");
	if (_POST['TYPE']=='MIME') {
		x=mime.read(_POST['DATA']);
		printvar(x);
	} else if (_POST['TYPE']=='XML') {
		x=xml.read(_POST['DATA']);
		printvar(x);
	}
	print("<HR></PRE>");
}

print(
	"<SCRIPT LANGUAGE=JavaScript>\n",
	"<!--\n",
	"document.test.command.focus();\n",
	"// -->\n",
	"</SCRIPT>\n"
);
print(
	"<SCRIPT LANGUAGE=JavaScript>\n<!--\n",
	"function showdebug() {\n",
	"	if (document.getElementById('debug').style.display=='none') {\n",
	"		document.getElementById('debug').style.display='block';\n",
	"	} else {\n",
	"		document.getElementById('debug').style.display='none';\n",
	"	}\n",
	"}\n",
	"// -->\n</SCRIPT>\n"
);
print("<A HREF=javascript:showdebug()>DEBUG</A>\n");
print("</CENTER>\n");
print("<DIV ID=debug STYLE='display:none'><PRE><FONT SIZE=2>\n");
printvar(_GLOBALS);
print("</FONT></PRE></DIV>\n");
print("</BODY>\n</HTML>\n");
