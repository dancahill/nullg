function profile_save() {

//	if (!(auth_priv(conn, "profile")&A_MODIFY)) {
//		print("<BR /><CENTER>%s</CENTER><BR />\r\n", lang_gets(conn, "common", "err_noaccess"));
//		return;
//	}
	if (_SERVER['REQUEST_METHOD']!='POST') return;
	global Q=ldir.getentry("person", tonumber(_USER.uidnumber));
	if (typeof(Q)=='null') {
//		print("<BR /><CENTER>%s</CENTER><BR />\r\n", lang_gets(conn, "common", "err_noaccess"));
		return;
	}
//	snprintf(opassword, sizeof(opassword)-1, "%s", ldir_getval(&qobj, 0, "userpassword"));
//	if ((ptemp=getpostenv(conn, "PASSWORD"))!=NULL) nes_setstr(conn->N, tobj, "userpassword", ptemp, strlen(ptemp));

//	if ((ptemp=getpostenv(conn, "PREFDAYSTART"))!=NULL)    user.prefdaystart=atoi(ptemp);
//	if ((ptemp=getpostenv(conn, "PREFDAYLENGTH"))!=NULL)   user.prefdaylength=atoi(ptemp);
//	if ((ptemp=getpostenv(conn, "PREFGEOZONE"))!=NULL)     user.prefgeozone=atoi(ptemp);

	if (typeof(_POST['PREFMAILCURRENT'])!='null') Q['_rows'][0]['_data']['pref']['mailcurrent'] = tonumber(_POST['PREFMAILCURRENT']);
	if (typeof(_POST['PREFMAILDEFAULT'])!='null') Q['_rows'][0]['_data']['pref']['maildefault'] = tonumber(_POST['PREFMAILDEFAULT']);
	if (typeof(_POST['PREFMAXLIST'])!='null')     Q['_rows'][0]['_data']['pref']['maxlist']     = tonumber(_POST['PREFMAXLIST']);
	if (typeof(_POST['PREFMENUSTYLE'])!='null')   Q['_rows'][0]['_data']['pref']['menustyle']   = tonumber(_POST['PREFMENUSTYLE']);
	if (typeof(_POST['PREFTIMEZONE'])!='null')    Q['_rows'][0]['_data']['pref']['timezone']    = tonumber(_POST['PREFTIMEZONE']);
	if (typeof(_POST['PREFLANGUAGE'])!='null')    Q['_rows'][0]['_data']['pref']['language']    = _POST['PREFLANGUAGE'];
	if (typeof(_POST['PREFTHEME'])!='null')       Q['_rows'][0]['_data']['pref']['theme']       = _POST['PREFTHEME'];
/*
	time_unix2sql(curdate, sizeof(curdate)-1, time(NULL));
	if (strcmp(opassword, user.password)!=0) {
		snprintf(user.password, sizeof(user.password)-1, "%s", auth_setpass(conn, user.password));
	}
*/
	if ((id=ldir.saveentry("person", tonumber(_USER.uidnumber), Q))<1) {
//		print("<BR /><CENTER>%s</CENTER><BR />\r\n", lang_gets(conn, "common", "err_noaccess"));
		return;
	}
	print("<CENTER>Profile modified successfully</CENTER><BR />\r\n");
//	db_log_activity(conn, "profile", 0, "modify", "%s - %s modified profile", conn->socket.RemoteAddr, conn->dat->username);
	print("<SCRIPT LANGUAGE=JavaScript TYPE=text/javascript>\r\n<!--\r\nlocation.replace(\"/profile/edit.ns\");\r\n// -->\r\n</SCRIPT>\r\n");
	print("<NOSCRIPT><META HTTP-EQUIV=\"Refresh\" CONTENT=\"0; URL=/profile/edit.ns\"></NOSCRIPT>\r\n");
	return;
}

profile_save();
